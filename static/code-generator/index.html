<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Conquest: Code Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #1a365d;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        .form-group.full-width {
            grid-column: 1 / -1;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2d3748;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }
        textarea {
            resize: vertical;
            height: 60px;
        }
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .checkbox-group input[type="checkbox"] {
            width: auto;
        }
        button {
            background-color: #1a365d;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #2c5282;
        }
        .info-panel {
            background-color: #e6fffa;
            border: 1px solid #38b2ac;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
        }
        .info-panel h3 {
            margin: 0 0 10px 0;
            color: #1a365d;
        }
        .print-area {
            width: 100%;
            margin-top: 20px;
        }
        .qr-grid {
            display: grid;
            width: 100%;
            gap: 0;
            margin-top: 20px;
        }
        .qr-item {
            text-align: center;
            background-color: white;
            padding: 20px;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-sizing: border-box;
        }
        .qr-item.with-border {
            border: 3px solid #000;
        }
        .qr-item.orienteering-flag {
            background: linear-gradient(135deg, white 50%, #ff6600 50%);
        }
        .qr-item.custom-colors {
            border: 2px solid var(--custom-border-color, #ff0000);
        }

        input[type="color"] {
            width: 60px;
            height: 40px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            padding: 0;
        }
        .qr-header {
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 14px;
            color: #1a365d;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 3px;
            display: block;
            text-align: center;
            line-height: 1.2;
        }
        .qr-code {
            background-color: white;
            padding: 12px;
            border-radius: 3px;
            margin: 10px;
            display: inline-block;
        }
        .qr-id {
            font-size: 10px;
            color: #666;
            word-break: break-all;
            background-color: rgba(255, 255, 255, 0.9);
            padding: 2px 4px;
            border-radius: 2px;
            max-width: 100%;
        }

        @media print {
            body {
                background-color: white;
                padding: 0;
                margin: 0;
                overflow: hidden;
            }
            .container {
                box-shadow: none;
                max-width: 100%;
                padding: 0;
                margin:0;
                height: auto;
                overflow: hidden;
            }
            .form-controls, button, .info-panel, h1 {
                display: none !important;
            }
            .print-area {
                margin-top: 0;
                padding:0;
                height: auto;
                overflow: hidden;
            }
            .qr-grid {
                gap: 0;
                margin-top: 0;
                height: auto;
                overflow: hidden;
                page-break-after: avoid;
            }
            .qr-item {
                break-inside: avoid;
                page-break-inside: avoid;
                padding: 3mm;
                height: auto;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .qr-item:last-child {
                page-break-after: avoid;
                margin-bottom: 0;
            }
            .qr-item.orienteering-flag {
                background: linear-gradient(135deg, white 50%, #ff6600 50%) !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .qr-item.custom-colors {
                border: 2px solid var(--custom-border-color, #ff0000) !important;
                -webkit-print-color-adjust: exact !important;
                color-adjust: exact !important;
                print-color-adjust: exact !important;
            }
            .qr-header {
                font-weight: bold !important;
                font-size: 12px !important;
                color: #1a365d !important;
                background-color: rgba(255, 255, 255, 0.9) !important;
                padding: 2px 6px !important;
                border-radius: 3px !important;
                display: block !important;
                text-align: center !important;
                margin-bottom: 5px !important;
            }
            .qr-item.with-border {
                border: 3px solid #000 !important;
            }
        }

        @media (max-width: 600px) {
            .form-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>QR Conquest: Enhanced Code Generator</h1>

        <div class="form-controls">
            <div class="form-group">
                <label for="paperSize">Paper Size:</label>
                <select id="paperSize" onchange="updateLayout()">
                    <option value="a4">A4 (210 × 297 mm)</option>
                    <option value="letter">Letter (8.5 × 11 in)</option>
                    <option value="a3">A3 (297 × 420 mm)</option>
                    <option value="tabloid">Tabloid (11 × 17 in)</option>
                </select>
            </div>

            <div class="form-group">
                <label for="columns">Number of Columns:</label>
                <select id="columns" onchange="updateLayout()">
                    <option value="2">2 Columns</option>
                    <option value="3" selected>3 Columns</option>
                    <option value="4">4 Columns</option>
                    <option value="5">5 Columns</option>
                    <option value="6">6 Columns</option>
                </select>
            </div>

            <div class="form-group full-width">
                <label for="headerText">Header Text (optional):</label>
                <textarea id="headerText" placeholder="Enter text to appear above each QR code (e.g., 'QR Conquest Base', 'Team Code', etc.)" onblur="updateLayout()"></textarea>
            </div>

            <div class="form-group">
                <label>Visual Style:</label>
                <select id="visualStyle" onchange="updateLayout()">
                    <option value="plain">Plain White</option>
                    <option value="border">Black Border</option>
                    <option value="orienteering">Orienteering Flag Pattern</option>
                    <option value="custom">Custom Colors</option>
                </select>
            </div>

            <div class="form-group" id="customColorsGroup" style="display: none;">
                <label for="backgroundColor">Background Color:</label>
                <input type="color" id="backgroundColor" value="#ffff00" onchange="updateLayout()">
                <label for="borderColor" style="margin-top: 10px;">Border Color:</label>
                <input type="color" id="borderColor" value="#ff0000" onchange="updateLayout()">
            </div>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="showUrl" checked onchange="updateLayout()">
                    <label for="showUrl">Show URL below QR code</label>
                </div>
            </div>
        </div>

        <button onclick="generateQRCodes()">Generate New QR Codes</button>
        <button onclick="window.print()">Print QR Codes</button>

        <div class="info-panel">
            <h3>Layout Information</h3>
            <div id="layoutInfo">
                <p><strong>QR Code Size:</strong> <span id="qrSize">200px</span></p>
                <p><strong>Codes per page:</strong> <span id="codesPerPage">12</span></p>
                <p><strong>Grid layout:</strong> <span id="gridLayout">3 × 4</span></p>
            </div>
        </div>

        <div class="print-area">
            <div id="qrGrid" class="qr-grid"></div>
        </div>
    </div>

    <script>
        // Paper sizes in pixels (approximated for screen display)
        const paperSizes = {
            a4: { width: 794, height: 1123 },      // 210mm × 297mm at 96dpi
            letter: { width: 816, height: 1056 },  // 8.5" × 11" at 96dpi
            a3: { width: 1123, height: 1587 },     // 297mm × 420mm at 96dpi
            tabloid: { width: 1056, height: 1632 } // 11" × 17" at 96dpi
        };

        function generateRandomID() {
            const characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_';
            let result = '';
            for (let i = 0; i < 11; i++) {
                result += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            return result;
        }

        function calculateOptimalLayout() {
            const paperSize = document.getElementById('paperSize').value;
            const columns = parseInt(document.getElementById('columns').value);
            const hasHeader = document.getElementById('headerText').value.trim() !== '';
            const showUrl = document.getElementById('showUrl').checked;

            const paper = paperSizes[paperSize];
            const margins = 60;

            // Calculate available space
            const availableWidth = paper.width - (2 * margins);
            const availableHeight = paper.height - (2 * margins) - 30;

            // Calculate item width (no gaps between items)
            const itemWidth = availableWidth / columns;

            // Calculate QR code size with more efficient padding
            let qrSize = itemWidth - 60;
            if (hasHeader) qrSize -= 25;
            if (showUrl) qrSize -= 15;

            // Allow smaller minimum QR codes for better space utilisation
            qrSize = Math.max(60, Math.min(300, qrSize));

            // Calculate item height with tighter spacing
            let itemHeight = qrSize + 40;
            if (hasHeader) itemHeight += 25;
            if (showUrl) itemHeight += 15;

            // Calculate how many rows fit
            console.log("raw rows ",availableHeight / itemHeight)
            const rows = Math.floor(availableHeight / itemHeight);
            const codesPerPage = columns * rows;

            return {
                qrSize: Math.floor(qrSize),
                columns: columns,
                rows: rows,
                codesPerPage: codesPerPage,
                itemWidth: Math.floor(itemWidth),
                itemHeight: Math.floor(itemHeight)
            };
        }

        function updateLayout() {
            const layout = calculateOptimalLayout();

            // Show/hide custom colors controls
            const visualStyle = document.getElementById('visualStyle').value;
            const customColorsGroup = document.getElementById('customColorsGroup');
            customColorsGroup.style.display = visualStyle === 'custom' ? 'block' : 'none';

            // Update info panel
            document.getElementById('qrSize').textContent = layout.qrSize + 'px';
            document.getElementById('codesPerPage').textContent = layout.codesPerPage;
            document.getElementById('gridLayout').textContent = `${layout.columns} × ${layout.rows}`;

            // Update grid CSS
            const grid = document.getElementById('qrGrid');
            grid.style.gridTemplateColumns = `repeat(${layout.columns}, 1fr)`;

            // Regenerate if we already have codes
            if (grid.children.length > 0) {
                generateQRCodes();
            }
        }

        function generateQRCodes() {
            const container = document.getElementById('qrGrid');
            container.innerHTML = ''; // Clear previous QR codes

            const layout = calculateOptimalLayout();
            const headerText = document.getElementById('headerText').value.trim();
            const visualStyle = document.getElementById('visualStyle').value;
            const showUrl = document.getElementById('showUrl').checked;

            // Extract base URL from current location
            const baseDomain = window.location.href.split('/code-generator')[0];

            // Generate QR codes to fill the page
            for (let i = 0; i < layout.codesPerPage; i++) {
                const uniqueID = generateRandomID();
                const url = `${baseDomain}/?id=${uniqueID}`;

                // Create container for each QR code
                const qrItem = document.createElement('div');
                qrItem.className = 'qr-item';

                // Apply visual style
                if (visualStyle === 'border') {
                    qrItem.classList.add('with-border');
                } else if (visualStyle === 'orienteering') {
                    qrItem.classList.add('orienteering-flag');
                } else if (visualStyle === 'custom') {
                    qrItem.classList.add('custom-colors');
                    const bgColor = document.getElementById('backgroundColor').value;
                    const borderColor = document.getElementById('borderColor').value;
                    qrItem.style.backgroundColor = bgColor;
                    qrItem.style.setProperty('--custom-border-color', borderColor);
                }

                // Add header text if specified
                if (headerText) {
                    const headerDiv = document.createElement('div');
                    headerDiv.className = 'qr-header';
                    headerDiv.textContent = headerText;
                    qrItem.appendChild(headerDiv);
                }

                // Create div for the QR code
                const qrDiv = document.createElement('div');
                qrDiv.className = 'qr-code';
                qrDiv.id = `qrcode-${i}`;
                qrItem.appendChild(qrDiv);

                // Add URL if enabled
                if (showUrl) {
                    const idDiv = document.createElement('div');
                    idDiv.className = 'qr-id';
                    idDiv.textContent = url;
                    qrItem.appendChild(idDiv);
                }

                container.appendChild(qrItem);

                // Generate the QR code
                new QRCode(qrDiv.id, {
                    text: url,
                    width: layout.qrSize,
                    height: layout.qrSize,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            }
        }

        // Initialize when page loads
        window.onload = function() {
            updateLayout();
            generateQRCodes();
        };
    </script>
</body>
</html>